/* kickstart 0.2.x (nightly) (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var kickStart=function(){function define(a,b){function c(a){for(var b in a)Array.isArray(a[b].assets)?(app._conf.modules.hasOwnProperty(b)&&app._conf.verbose&&console.log("ERROR: module "+b+" is already registered."),app._conf.modules[b]=$.extend({assets:{}},a[b],{ready:!1,files:{}})):c(a[b])}"string"==typeof a?$.ajax({url:app._conf.baseURL+a,dataType:"text",cache:app._conf.cache,success:function(d,e,f){if("success"!=e)return void(app._conf.verbose&&console.log('ERROR: error while loading module definition from "'+a+'".'));try{a=JSON.parse(d)}catch(b){return void(app._conf.verbose&&console.log('ERROR: not valid JSON file  "'+a+'".\n'+b))}c(a),"function"==typeof b&&b()},error:function(b,c,d){app._conf.verbose&&console.log('ERROR: error while loading module definition from "'+a+'".')}}):(c(a),"function"==typeof b&&b())}function register(a,b){if(app.hasOwnProperty(a))return app._conf.verbose&&console.log("ERROR: Namespace "+a+" is already registered"),!1;if(!app._conf.modules.hasOwnProperty(a))return app._conf.verbose&&console.log("ERROR: Namespace "+a+" is not defined, first define it with kickStart.define"),!1;var c=app._conf.modules[a];app[a]=b(c.files,c),app._conf.modules[a].ready=!0}function require(names,callBack){function isFinished(){0==modCount&&(failed!==!0&&("function"==typeof promise._done&&promise._done(app._conf.modules[name]),"function"==typeof callBack&&callBack()),"function"==typeof promise._always&&promise._always())}$.isArray(names)||(names=[names]);var modCount=names.length,failed=!1,promise={ready:function(a){return promise._ready=a,promise},fail:function(a){return promise._fail=a,promise},done:function(a){return promise._done=a,promise},always:function(a){return promise._always=a,promise}};return setTimeout(function(){for(var n in names){var name=names[n];"undefined"!=typeof app[name]?(modCount--,isFinished()):"undefined"==typeof app._conf.modules[name]?app._conf.verbose&&console.log("ERROR: module "+name+" is not defined."):!function(name){getFiles(app._conf.modules[name].assets.concat([app._conf.modules[name].start]),function(files){var start=files[app._conf.modules[name].start];delete files[app._conf.modules[name].start],app._conf.modules[name].files=files,app._conf.modules[name].ready=!0;try{eval(start)}catch(a){failed=!0;var err=a.stack.split("\n"),tmp=err[1].match(/<anonymous>:([\d]){1,10}:([\d]{1,10})/gi);tmp&&(tmp=tmp[0].split(":")),tmp?app._conf.verbose&&(console.error("ERROR: "+err[0]+" ==> "+app._conf.modules[name].start+", line: "+tmp[1]+", character: "+tmp[2]),console.log(a.stack)):app._conf.verbose&&(console.error("ERROR: "+app._conf.modules[name].start),console.log(a.stack)),"function"==typeof promise._fail&&promise._fail(app._conf.modules[name])}"function"==typeof promise._ready&&promise._ready(app._conf.modules[name]),modCount--,isFinished()})}(name)}},1),promise}function getFiles(a,b){function c(){e--,e<=0&&b(d)}var d={},e=a.length;for(var f in a)!function(){var b=a[f],e=$('script[path="'+b+'"]');e.length>0?(d[b]=e.html(),c()):$.ajax({url:app._conf.baseURL+b,dataType:"text",cache:app._conf.cache,success:function(a,e,f){return"success"!=e?void(app._conf.verbose&&console.log("ERROR: error while getting a file "+b+".")):(d[b]=f.responseText,void c())},error:function(e,g,h){"error"==g?app._conf.verbose&&console.log("ERROR: failed to load "+a[f]+"."):(app._conf.verbose&&console.log('ERROR: file "'+a[f]+'" is loaded, but with a parsing error(s) in line '+h.line+": "+h.message),d[b]=xhr.responseText,c())}})}()}var app={_conf:{name:"unnamed",baseURL:"",cache:!1,modules:{},verbose:!0},define:define,require:require,register:register};return window.app||(window.app=app),app}();kickStart.define({route:{assets:[]}}),kickStart.register("route",function(){function a(a){""===f()?d(a):i()}function b(a,b){if("object"==typeof a){for(var c in a){var d=String("/"+c).replace(/\/{2,}/g,"/");m[d]=a[c]}return l.route}if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof l.route.trigger){var e=l.route.trigger({phase:"before",type:"add",target:"self",route:a,handler:b});if(e.isCancelled===!0)return!1}return m[a]=b,"function"==typeof l.route.trigger&&l.route.trigger($.extend(e,{phase:"after"})),l.route}function c(a){if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof l.route.trigger){var b=l.route.trigger({phase:"before",type:"remove",target:"self",route:a,handler:handler});if(b.isCancelled===!0)return!1}return delete m[a],delete n[a],"function"==typeof l.route.trigger&&l.route.trigger($.extend(b,{phase:"after"})),l.route}function d(a){return a=String("/"+a).replace(/\/{2,}/g,"/"),window.history.replaceState({},document.title,"#"+a),i(),l.route}function e(a){return a=String("/"+a).replace(/\/{2,}/g,"/"),window.history.replaceState({},document.title,"#"+a),l.route}function f(){return window.location.hash.substr(1).replace(/\/{2,}/g,"/")}function g(){var a=[],b=!1,c=!1,d=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==d&&(d="/");for(var e in n){var f={},g=n[e].path.exec(d);if(null!=g){b=!0,c||e.indexOf("*")!==-1||(c=!0);var h=1;for(var i in n[e].keys)f[n[e].keys[i].name]=g[h],h++;a.push({name:e,path:d,params:f})}}return a}function h(){j();var a={};for(var b in m){var c=n[b].keys,d=[];for(var e in c)d.push(c[e].name);a[b]=d}return a}function i(){function a(a){if(v.routeRE=v.routeRE||{},null==v.routeRE[a]&&(v.routeRE[a]=j(a)),!v.ready&&a&&v.routeRE[a].path.exec(b)&&t.indexOf(u)==-1)return l._conf.verbose&&console.log('ROUTER: Auto Load Module "'+u+'"'),e=!0,r++,t.push(u),void l.require(u).done(function(){r--,l._conf.modules[u]&&0===r&&i()})}j();var b=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==b&&(b="/");var c=!1,d=!1,e=!1;for(var f in n){var g={},h=n[f].path.exec(b);if(null!=h){c=!0,d||f.indexOf("*")!==-1||(d=!0);var k=1;for(var o in n[f].keys)g[n[f].keys[o].name]=h[k],k++;if("function"==typeof l.route.trigger){var p=l.route.trigger({phase:"before",type:"route",target:"self",route:f,params:g});if(p.isCancelled===!0)return!1}m[f]({name:f,path:b,params:g},g);"function"==typeof l.route.trigger&&l.route.trigger($.extend(p,{phase:"after"}));var q=window.location.hash.substr(1).replace(/\/{2,}/g,"/");if(b!==q)return}}var r=0,s=l._conf.modules,t=[];for(var u in s){var v=s[u],w=v.route;null!=w&&("string"==typeof w&&(w=[w]),Array.isArray(w)&&w.forEach(function(b){a(b)}))}if(e||d||!l._conf.verbose||console.log('ROUTER: Exact route for "'+b+'" not found'),!c){if("function"==typeof l.route.trigger){var p=l.route.trigger({phase:"before",type:"error",target:"self",hash:b});if(p.isCancelled===!0)return!1}!e&&l._conf.verbose&&console.log('ROUTER: Wild card route for "'+b+'" not found'),"function"==typeof l.route.trigger&&l.route.trigger($.extend(p,{phase:"after"}))}}function j(a){function b(a){var b=[],c=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+c+"$","i"),keys:b}}if(null!=a)return b(a);for(var a in m)n[a]||(n[a]=b(a))}function k(){window.addEventListener?window.addEventListener("hashchange",i,!1):window.attachEvent("onhashchange",i)}var l=kickStart,m={},n={};k();var o={init:a,add:b,remove:c,go:d,set:e,get:f,info:g,process:i,list:h,onAdd:null,onRemove:null,onRoute:null};return"undefined"!=typeof w2utils&&$.extend(o,w2utils.event,{handlers:[]}),o});